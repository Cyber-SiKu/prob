def feature(artifactId, versionNumber) { """
<?xml version="1.0" encoding="UTF-8"?>
	<project
		xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd" xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<modelVersion>4.0.0</modelVersion>
		<parent>
			<groupId>${groupId()}</groupId>
			<artifactId>${parentId()}</artifactId>
			<version>1.0.0.qualifier</version>
			<relativePath>../${parentId()}/pom.xml</relativePath>
		</parent>
		<groupId>${groupId()}</groupId>
		<artifactId>${artifactId}</artifactId>
		<version>${versionNumber}</version>
		<packaging>eclipse-feature</packaging>
	</project>
"""}

deploy <<{

	boolean idfound = false

	content = new File("${project.name}/feature.xml").getText("UTF-8") 

	printFileLine = {
		
		if(  it ==~ /.+version.+qualifier.+/ ){
			versionNumber = it.substring(15,it.size()-1) 
			// possibile error: cuts off first 15 chars and leaves out last '"'
			
			/*	Version Number is taken from Feature.xml 
			*	feature.xml is searched for version="version.qualifier"
			*	first 15 chars and last '"' are cut off
			*/

		}
		
		
		if(  it ==~ /.+id=".+/ && idfound == false ){
			artifactId = it.substring(10,it.length()-1)
			idfound = true
		}
		/*	Artifact ID is taken from Bundle-SymbolicName minus the
		*	16 chars ';singleton:=true'
		*/
	}
	
	content.eachLine( printFileLine )

	
	println artifactId
	println "\t"+versionNumber


	def f = new File(artifactId+'/pom.xml') 
	f.delete()
	f << feature(artifactId, versionNumber)
	
}